<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Beats</title>
<style>
  body { font-family: Arial; background: #111; color: #fff; padding: 20px; }
  h1 { text-align: center; color: #4cffb3; }
  form { display: flex; flex-direction: column; max-width: 400px; margin: auto; gap: 10px; }
  input, button { padding: 10px; border-radius: 5px; border: none; }
  input[type="file"] { background: #222; color: #fff; }
  button { background: #4cffb3; color: #111; cursor: pointer; }
</style>
</head>
<body>

<h1>Admin Beats</h1>

<form id="addBeatForm">
  <input type="text" placeholder="Nombre del beat" id="beatName" required>
  <input type="text" placeholder="Género" id="beatGenero" required>
  <input type="file" accept="image/*" id="beatCover" required>
  <input type="file" accept="audio/*" id="beatMP3" required>
  <button type="submit">Agregar Beat</button>
</form>

<script>
const pwd = prompt("Ingrese contraseña:");
if(pwd !== "TuClaveSecreta"){
  alert("Acceso denegado");
  window.location.href = "/";
}

document.getElementById("addBeatForm").addEventListener("submit", async e => {
  e.preventDefault();

  const name = document.getElementById("beatName").value;
  const genre = document.getElementById("beatGenero").value;
  const coverFile = document.getElementById("beatCover").files[0];
  const mp3File = document.getElementById("beatMP3").files[0];

  if(!coverFile || !mp3File) return alert("Selecciona archivos");

  const toBase64 = file => new Promise((res, rej) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => res(reader.result);
    reader.onerror = err => rej(err);
  });

  const coverData = await toBase64(coverFile);
  const mp3Data = await toBase64(mp3File);

  // Enviar al serverless
  const res = await fetch("/api/addBeat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nombre: name, genero: genre, cover: coverData, mp3: mp3Data })
  });

  if(res.ok){
    alert("Beat agregado correctamente");
    document.getElementById("addBeatForm").reset();
  } else {
    alert("Error al agregar beat");
  }
});
</script>

</body>
</html>